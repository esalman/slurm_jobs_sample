% Aggregates csv files generated by each task in a job array
% @param location of csv files generated by the tasks
% @return a csv table, missing IDs

tic

% inputs
outpath = fullfile('../results/cvi_job_outputs/');

% load results
t1 = tabularTextDatastore( outpath, 'FileExtensions', '.csv' );
t1 = readall(t1);
cvi = unstack(t1(:,{'criteria', 'cvi', 'K'}), 'cvi', 'K');
writetable( cvi, fullfile( outpath, '../cvi_job_results.csv' ) )

% missing or incomplete tasks
missing_id = find(~(ismember(1:39, t1.task_id)));
missing_id = strjoin(arrayfun(@(x) num2str(x), missing_id, 'UniformOutput', false), ',');
disp(['missing tasks: ', missing_id])

disp('DONE!')
toc